<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>WTP &amp; Simulations</title>
    <meta charset="utf-8" />
    <meta name="author" content="John Paul Helveston" />
    <meta name="date" content="2022-11-09" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/tile-view/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view/tile-view.js"></script>
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <script src="libs/clipboard/clipboard.min.js"></script>
    <link href="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"Copy Code","success":"Copied!","error":"Press Ctrl+C to Copy"})</script>
    <link href="libs/shareon/shareon.min.css" rel="stylesheet" />
    <script src="libs/shareon/shareon.min.js"></script>
    <link href="libs/xaringanExtra-shareagain/shareagain.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-shareagain/shareagain.js"></script>
    <link href="libs/xaringanExtra-extra-styles/xaringanExtra-extra-styles.css" rel="stylesheet" />
    <meta name="description" content="EMSE 6035: Marketing Analytics for Design Decisions"/>
    <meta name="generator" content="xaringan and remark.js"/>
    <meta name="github-repo" content="emse-madd-gwu/2022-Fall"/>
    <meta name="twitter:title" content="WTP &amp; Simulations"/>
    <meta name="twitter:description" content="EMSE 6035: Marketing Analytics for Design Decisions"/>
    <meta name="twitter:url" content="https://madd.seas.gwu.edu/2022-Fall/"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:creator" content="@johnhelveston"/>
    <meta name="twitter:site" content="@johnhelveston"/>
    <meta property="og:title" content="WTP &amp; Simulations"/>
    <meta property="og:description" content="EMSE 6035: Marketing Analytics for Design Decisions"/>
    <meta property="og:url" content="https://madd.seas.gwu.edu/2022-Fall/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:locale" content="en_US"/>
    <meta property="article:author" content="John Paul Helveston"/>
    <link href="libs/countdown/countdown.css" rel="stylesheet" />
    <script src="libs/countdown/countdown.js"></script>
    <link rel="stylesheet" href="css/lexis.css" type="text/css" />
    <link rel="stylesheet" href="css/lexis-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">




class: middle, inverse

.leftcol30[

&lt;center&gt;
&lt;img src="https://github.com/emse-madd-gwu/emse-madd-gwu.github.io/raw/master/images/logo.png" width=250&gt;
&lt;/center&gt;

]

.rightcol70[

# Week 11: .fancy[WTP &amp; Simulations]

### <svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:white;overflow:visible;position:relative;"><path d="M243.4 2.6l-224 96c-14 6-21.8 21-18.7 35.8S16.8 160 32 160v8c0 13.3 10.7 24 24 24H456c13.3 0 24-10.7 24-24v-8c15.2 0 28.3-10.7 31.3-25.6s-4.8-29.9-18.7-35.8l-224-96c-8.1-3.4-17.2-3.4-25.2 0zM128 224H64V420.3c-.6 .3-1.2 .7-1.8 1.1l-48 32c-11.7 7.8-17 22.4-12.9 35.9S17.9 512 32 512H480c14.1 0 26.5-9.2 30.6-22.7s-1.1-28.1-12.9-35.9l-48-32c-.6-.4-1.2-.7-1.8-1.1V224H384V416H344V224H280V416H232V224H168V416H128V224zm128-96c-17.7 0-32-14.3-32-32s14.3-32 32-32s32 14.3 32 32s-14.3 32-32 32z"/></svg> EMSE 6035: Marketing Analytics for Design Decisions
### <svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:white;overflow:visible;position:relative;"><path d="M272 304h-96C78.8 304 0 382.8 0 480c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32C448 382.8 369.2 304 272 304zM48.99 464C56.89 400.9 110.8 352 176 352h96c65.16 0 119.1 48.95 127 112H48.99zM224 256c70.69 0 128-57.31 128-128c0-70.69-57.31-128-128-128S96 57.31 96 128C96 198.7 153.3 256 224 256zM224 48c44.11 0 80 35.89 80 80c0 44.11-35.89 80-80 80S144 172.1 144 128C144 83.89 179.9 48 224 48z"/></svg> John Paul Helveston
### <svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:white;overflow:visible;position:relative;"><path d="M152 64H296V24C296 10.75 306.7 0 320 0C333.3 0 344 10.75 344 24V64H384C419.3 64 448 92.65 448 128V448C448 483.3 419.3 512 384 512H64C28.65 512 0 483.3 0 448V128C0 92.65 28.65 64 64 64H104V24C104 10.75 114.7 0 128 0C141.3 0 152 10.75 152 24V64zM48 448C48 456.8 55.16 464 64 464H384C392.8 464 400 456.8 400 448V192H48V448z"/></svg> November 09, 2022

]

---



class: inverse, middle

# Week 11: .fancy[WTP &amp; Simulations]

### 1. Computing "Willingness to Pay" (WTP)
### 2. Incorporating Uncertainty via Simulation
### 3. Directly Estimating WTP

### BREAK

### 4. Simulating Market Shares

---



class: inverse, middle

# Week 11: .fancy[WTP &amp; Simulations]

### 1. .orange[Computing "Willingness to Pay" (WTP)]
### 2. Incorporating Uncertainty via Simulation
### 3. Directly Estimating WTP

### BREAK

### 4. Simulating Market Shares

---

class: center 

## Willingness to Pay (WTP)

&lt;br&gt;

## `$$\tilde{u}_j = \alpha p_j + \boldsymbol{\beta} x_j + \tilde{\varepsilon_j}$$`

&lt;br&gt;

--

## `$$\boldsymbol{\omega} = \frac{\boldsymbol{\beta}}{-\alpha}$$`

---

class: center

# Notational convention

.leftcol[

# Model 
## `$$\tilde{u}_j = \alpha p_j + \boldsymbol{\beta} x_j + \tilde{\varepsilon_j}$$`
## `$$\boldsymbol{\omega} = \frac{\boldsymbol{\beta}}{-\alpha}$$`

]

.rightcol[

# Estimated Model
## `$$\tilde{u}_j = \hat{\alpha} p_j + \hat{\boldsymbol{\beta}} x_j + \tilde{\varepsilon_j}$$`
## `$$\hat{\boldsymbol{\omega}} = \frac{\hat{\boldsymbol{\beta}}}{-\hat{\alpha}}$$`

]

---

class: inverse

# Practice Question 1

.leftcol[

Suppose we estimate the following utility model describing preferences for cars:

$$
\tilde{u}_j = \alpha p_j + \beta_1 x_j^{\mathrm{mpg}} + \beta_2 x_j^{\mathrm{elec}} + \varepsilon_j
$$

The estimated model produces the following coefficients:

- `\(\alpha\)`: -0.7
- `\(\beta_1\)`: 0.1
- `\(\beta_2\)`: -4.0

]

.rightcol[

a) Use the estimated coefficients to compute the WTP for fuel economy and electric car vehicle type.

]

---



class: inverse, middle

# Week 11: .fancy[WTP &amp; Simulations]

### 1. Computing "Willingness to Pay" (WTP)
### 2. .orange[Incorporating Uncertainty via Simulation]
### 3. Directly Estimating WTP

### BREAK

### 4. Simulating Market Shares

---

# .center[Simulating uncertainty]

We can use the coefficients and hessian from a model to obtain draws that reflect parameter uncertainty

.leftcol[


```r
beta &lt;- c(-0.7, 0.1, -4.0)

hessian &lt;- matrix(c(
    -6000,   50,   60,
       50, -700,   50,
       60,   50, -300),
    ncol = 3, byrow = TRUE)
```

]

.rightcol[


```r
covariance &lt;- -1*solve(hessian)
draws &lt;- MASS::mvrnorm(10^4, beta, covariance)

head(draws)
```

```
#&gt;            [,1]       [,2]      [,3]
#&gt; [1,] -0.7161138 0.04251578 -3.962513
#&gt; [2,] -0.6679818 0.09678488 -3.974081
#&gt; [3,] -0.6926573 0.09303158 -3.979829
#&gt; [4,] -0.7161590 0.09736044 -4.017811
#&gt; [5,] -0.7168487 0.13808505 -3.977487
#&gt; [6,] -0.6947676 0.13929996 -4.016169
```

]

---

# .center[Computing WTP with draws]

## `$$\hat{\boldsymbol{\omega}} = \frac{\hat{\boldsymbol{\beta}}}{-\hat{\alpha}}$$`

--

.leftcol55[


```r
draws_other &lt;- draws[,2:ncol(draws)]
draws_price &lt;- draws[,1]
draws_wtp &lt;- draws_other / (-1*draws_price)
head(draws_wtp)
```

```
#&gt;            [,1]      [,2]
#&gt; [1,] 0.05937014 -5.533357
#&gt; [2,] 0.14489150 -5.949386
#&gt; [3,] 0.13431113 -5.745740
#&gt; [4,] 0.13594808 -5.610223
#&gt; [5,] 0.19262788 -5.548572
#&gt; [6,] 0.20049864 -5.780593
```

]

--

.rightcol45[

Mean WTP with confidence interal

```r
maddTools::ci(draws_wtp)
```

```
#&gt;         mean       lower     upper
#&gt; 1  0.1431816  0.03346827  0.250165
#&gt; 2 -5.7169939 -5.97960215 -5.465543
```

]

---

class: inverse

## Practice Question 2

Suppose we estimate the following utility model describing preferences for cars:

$$
\tilde{u}_j = \alpha p_j + \beta_1 x_j^{\mathrm{mpg}} + \beta_2 x_j^{\mathrm{elec}} + \varepsilon_j
$$

.leftcol[

The estimated model produces the following coefficients and hessian:

- `\(\alpha\)`: -0.7
- `\(\beta_1\)`: 0.1
- `\(\beta_2\)`: -4.0

$$
\nabla_{\beta}^2 \ln(\mathcal{L}) =
`\begin{bmatrix}
-6000 &amp; 50 &amp; 60
\\
50 &amp; -700 &amp; 50
\\
60 &amp; 50 &amp; -300
\end{bmatrix}`
$$

]

.rightcol[

a) Generate 10,000 draws of the model coefficients using the estimated coefficients and hessian. Use the `mvrnorm()` function from the `MASS` library.

b) Use the draws to compute the mean WTP and 95% confidence intervals of WTP for fuel economy and electric car vehicle type.

]

---

# .center[Computing WTP from an estimated model]

&lt;br&gt;

.rightcol80[

## 1. Open `logitr-cars`

## 2. Open `code/6.1-compute-wtp.R`

]

---

class: inverse

<div class="countdown" id="timer_636af7d3" style="top:0;right:0;font-size:2em;" data-warnwhen="15">
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

## Your Turn

.leftcol80[.font120[

As a team, compute the WTP from an estimated model you used in your pilot analysis report

]]

---



class: inverse, middle

# Week 11: .fancy[WTP &amp; Simulations]

### 1. Computing "Willingness to Pay" (WTP)
### 2. Incorporating Uncertainty via Simulation
### 3. .orange[Directly Estimating WTP]

### BREAK

### 4. Simulating Market Shares

---

class: center 

## Willingness to Pay (WTP)

.leftcol[

## "Preference Space"

## `$$\tilde{u}_j = \alpha p_j + \boldsymbol{\beta} x_j + \tilde{\varepsilon_j}$$`

]

--

.rightcol[

## "WTP Space"

## `$$\boldsymbol{\omega} = \frac{\boldsymbol{\beta}}{-\alpha}$$`
## `$$\lambda = - \alpha$$`
## `$$\tilde{u}_j = \lambda (\boldsymbol{\omega} x_j - p_j) + \tilde{\varepsilon_j}$$`

]

---

background-color: #EEEDEE
class: center 

# WTP space models have **non-convex**&lt;br&gt;log-likelihood functions!

&lt;center&gt;
&lt;img src="images/conditions.png" width=850&gt;
&lt;/center&gt;

---

class: center 

# WTP space models have non-convex&lt;br&gt;log-likelihood functions!

&lt;br&gt;

# **Use multi-start loop with&lt;br&gt;random starting points**

---

# .center[Computing WTP from an estimated model]

&lt;br&gt;

.rightcol80[

## 1. Open `logitr-cars`

## 2. Open `code/6.2-model-wtp.R`

]

---

class: inverse

<div class="countdown" id="timer_636af676" style="top:0;right:0;font-size:2em;" data-warnwhen="15">
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

## Your Turn

.leftcol80[.font120[

As a team, re-estimate the main model you used in your pilot analysis report, but now in the WTP space.

Try plotting your results (see `6.3-plot-wtp.R` for examples)

]]

---

class: inverse, center

# .fancy[Break]

<div class="countdown" id="timer_636af8d1" style="top:1;right:0;bottom:0;left:0;margin:5%;font-size:8em;" data-warnwhen="30">
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---



class: inverse, middle

# Week 11: .fancy[WTP &amp; Simulations]

### 1. Computing "Willingness to Pay" (WTP)
### 2. Incorporating Uncertainty via Simulation
### 3. Directly Estimating WTP

### BREAK

### 4. .orange[Simulating Market Shares]

---

background-color: #EEEDEE
class: center

## We want to find `\(\boldsymbol{\beta}\)` by maximizing the log-likelihood

&lt;center&gt;
&lt;img src="images/mle1.png" width=1000&gt;
&lt;img src="images/mle2.png" width=500&gt;
&lt;/center&gt;

---

# .center[Simulate Market Shares]

## 1. Define a market, `\(X\)`

## 2. Compute shares:

## `$$\hat{P}_j = \frac{e^{\hat{\boldsymbol{\beta}}'\boldsymbol{X}_j}}{\sum_{k=1}^J e^{\hat{\boldsymbol{\beta}}'\boldsymbol{X}_k}}$$`

---

background-color: #EEEDEE

# .center[Simulate Market Shares]

&lt;center&gt;
&lt;img src="images/matrixmath.png" width=700&gt;
&lt;/center&gt;

---

background-color: #EEEDEE

# .center[Simulate Market Shares]

.leftcol70[

&lt;center&gt;
&lt;img src="images/matrixmath.png" width=700&gt;
&lt;/center&gt;

]

.rightcol30[

In R:

```r
X %*% beta
```

]

---

class: inverse

# Practice Question 1

.leftcol[

Suppose we estimate the following utility model describing preferences for cars:

$$
\tilde{u}_j = \alpha p_j + \beta_1 x_j^{\mathrm{mpg}} + \beta_2 x_j^{\mathrm{elec}} + \varepsilon_j
$$

The estimated model produces the following coefficients:

- `\(\alpha\)`: -0.7
- `\(\beta_1\)`: 0.1
- `\(\beta_2\)`: -4.0

]

.rightcol[

a) Use the estimated coefficients to compute the WTP for fuel economy and electric car vehicle type.

b) Use the estimated coefficients to compute market shares for the alternatives in the following market:


alternative | price | mpg | elec
------------|-------|-----|--------
1 | 15 | 20 | 0
2 | 30 | 100 | 1
3 | 20 | 40 | 0

]

---

# .center[Simulating Market Shares with Uncertainty]

We can use the coefficients and hessian from a model to obtain draws that reflect parameter uncertainty

.leftcol[


```r
beta &lt;- c(-0.7, 0.1, -4.0)

hessian &lt;- matrix(c(
    -6000,   50,   60,
       50, -700,   50,
       60,   50, -300),
    ncol = 3, byrow = TRUE)
```

]

.rightcol[


```r
covariance &lt;- -1*solve(hessian)
draws &lt;- MASS::mvrnorm(10^4, beta, covariance)

head(draws)
```

```
#&gt;            [,1]       [,2]      [,3]
#&gt; [1,] -0.6994714 0.07871118 -4.057312
#&gt; [2,] -0.7046625 0.06870760 -3.918736
#&gt; [3,] -0.7196215 0.06599735 -4.030982
#&gt; [4,] -0.6974224 0.07829723 -4.076801
#&gt; [5,] -0.7068202 0.13839250 -3.942513
#&gt; [6,] -0.7192083 0.11363566 -4.054808
```

]

---

# .center[Simulating Market Shares with Uncertainty]

Rely on the `predict()` function to compute shares with uncertainty. 

Internally, it:

1. Takes draws of `\(\boldsymbol{\beta}\)`
2. Computes `\(P_j\)` for each draw 
3. Returns mean and confidence interval computed from draws

---

# .center[Simulating Market Shares with Uncertainty]

&lt;br&gt;

.rightcol80[

## 1. Open `logitr-cars`

## 2. Open `code/7.1-compute-market-sims.R`

]

---

class: inverse

<div class="countdown" id="timer_636af5a1" style="top:0;right:0;font-size:2em;" data-warnwhen="15">
<code class="countdown-time"><span class="countdown-digits minutes">20</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

## Your Turn

## As a team: 

1. Develop one or two scenarios pitting your product against one or more competitors. 
2. Use one of your estimated models and the `predict()` function to predict market shares for those scenarios. 
3. Try plotting your results (see `7.2-plot-market-sims.R` for examples)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
